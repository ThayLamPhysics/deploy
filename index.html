<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuyển đổi HTML sang Google Apps Script</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(21, 32, 53, 0.7); /* slate-800 with opacity */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(56, 189, 248, 0.2); /* cyan-400 with opacity */
        }
        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #f1f5f9; /* slate-100 */
            color: #0f172a; /* slate-900 */
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.5s, visibility 0.5s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .toast.show {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <div class="text-center mb-8">
            <h2 class="text-2xl md:text-3xl font-bold text-white">Hướng dẫn Deploy lên Google Apps Script</h2>
            <div class="text-left max-w-3xl mx-auto mt-4 text-slate-300 bg-slate-800/50 p-6 rounded-lg border border-slate-700">
                <ol class="list-decimal list-inside space-y-3">
                    <li><strong>Tạo dự án mới:</strong> Truy cập <a href="https://script.google.com/home/projects/create" target="_blank" class="text-cyan-400 hover:underline font-semibold">Google Apps Script</a> để tạo một dự án mới.</li>
                    <li><strong>Dán mã:</strong> Xóa toàn bộ mã mặc định trong tệp <code>Code.gs</code> và dán mã đã được tạo ở ô số 2 vào.</li>
                    <li><strong>Lưu dự án:</strong> Nhấn vào biểu tượng đĩa mềm (Lưu dự án) hoặc nhấn <code>Ctrl + S</code>.</li>
                    <li><strong>Triển khai (Deploy):</strong>
                        <ul class="list-disc list-inside ml-5 mt-2 space-y-1">
                            <li>Nhấn nút <strong class="text-cyan-300">"Triển khai"</strong> màu xanh ở góc trên bên phải, sau đó chọn <strong>"Lần triển khai mới"</strong>.</li>
                            <li>Trong mục "Chọn loại", chọn biểu tượng bánh răng và chọn <strong>"Ứng dụng web"</strong>.</li>
                            <li>Trong phần "Ai có quyền truy cập", chọn <strong>"Bất kỳ ai"</strong>.</li>
                            <li>Nhấn nút <strong>"Triển khai"</strong>.</li>
                        </ul>
                    </li>
                    <li><strong>Cấp quyền:</strong> Google sẽ yêu cầu bạn cấp quyền. Nhấn <strong>"Ủy quyền truy cập"</strong>, chọn tài khoản của bạn, sau đó chọn "Nâng cao" và "Đi tới dự án (không an toàn)" để hoàn tất.</li>
                    <li><strong>Hoàn tất:</strong> Sao chép <strong>URL Ứng dụng web</strong> được cung cấp và dán vào trình duyệt để xem trang web của bạn.</li>
                </ol>
            </div>
        </div>

        <div class="glass-card p-6 rounded-2xl shadow-lg">
            <div class="flex flex-col gap-6">
                <!-- Cột nhập HTML -->
                <div>
                    <label for="htmlInput" class="block text-lg font-semibold mb-2 text-slate-200">1. Dán mã HTML của bạn vào đây:</label>
                    <textarea id="htmlInput" class="w-full h-80 p-4 border border-slate-600 bg-slate-900 text-slate-200 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition duration-200 resize-none" placeholder="<!DOCTYPE html>..."></textarea>
                </div>

                <!-- Nút chuyển đổi -->
                <div class="text-center">
                    <button id="convertButton" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-cyan-300">
                        Chuyển đổi
                    </button>
                </div>

                <!-- Cột xuất Code.gs -->
                <div>
                    <label for="gsOutput" class="block text-lg font-semibold mb-2 text-slate-200">2. Mã `Code.gs` hoàn chỉnh:</label>
                    <div class="relative h-80">
                        <pre class="w-full h-full p-4 border border-slate-700 bg-slate-900 rounded-lg overflow-auto"><code id="gsOutput" class="language-javascript text-slate-400">// Mã được tạo sẽ xuất hiện ở đây...</code></pre>
                        <button id="copyButton" class="absolute top-3 right-3 bg-slate-600 hover:bg-slate-500 text-slate-100 font-semibold py-1 px-3 rounded-md text-sm transition duration-200 disabled:opacity-50" disabled>
                            Sao chép
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thông báo pop-up -->
    <div id="toast" class="toast">Đã sao chép vào clipboard!</div>

    <script>
        const convertButton = document.getElementById('convertButton');
        const copyButton = document.getElementById('copyButton');
        const htmlInput = document.getElementById('htmlInput');
        const gsOutput = document.getElementById('gsOutput');
        const toast = document.getElementById('toast');

        // Hàm để tạo mã Code.gs
        function generateGsCode() {
            const htmlContent = htmlInput.value;

            if (!htmlContent.trim()) {
                gsOutput.textContent = "// Vui lòng nhập mã HTML...";
                gsOutput.classList.add('text-slate-400');
                copyButton.disabled = true;
                return;
            }

            // NÂNG CẤP: Tự động "thoát" các ký tự ` và ${ để tránh lỗi cú pháp.
            const escapedHtml = htmlContent
                .replace(/`/g, '\\`')       // Thay thế ` thành \`
                .replace(/\$\{/g, '\\${');  // Thay thế ${ thành \${

            const gsCode = `
function doGet(e) {
  // Tạo output HTML từ một chuỗi.
  // Toàn bộ mã HTML của bạn được nhúng bên trong cặp dấu \` \`.
  var html = \`
${escapedHtml}
  \`;

  return HtmlService.createHtmlOutput(html)
      .setTitle("My Web App") // Bạn có thể thay đổi tiêu đề trang web ở đây
      .addMetaTag('viewport', 'width=device-width, initial-scale=1');
}
            `.trim();

            gsOutput.textContent = gsCode;
            gsOutput.classList.remove('text-slate-400');
            copyButton.disabled = false;
        }

        // Hàm để sao chép mã
        function copyCode() {
            // Tạo một textarea tạm thời để thực hiện lệnh copy
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = gsOutput.textContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            try {
                document.execCommand('copy');
                showToast();
            } catch (err) {
                console.error('Không thể sao chép: ', err);
                alert('Rất tiếc, không thể sao chép mã. Vui lòng sao chép thủ công.');
            }
            
            document.body.removeChild(tempTextArea);
        }

        // Hàm hiển thị thông báo
        function showToast() {
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000); // Ẩn sau 3 giây
        }

        // Gán sự kiện cho các nút
        convertButton.addEventListener('click', generateGsCode);
        copyButton.addEventListener('click', copyCode);
    </script>

</body>
</html>
